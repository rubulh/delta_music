
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD profile="http://gmpg.org/xfn/11" xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml"><meta property="og:title" content="Bits of PHP code - No Caching - James Cridland"/><meta property="og:url" content="http://james.cridland.net/code/caching.html"/><meta property="fb:admins" content="753435092" /><meta property="og:image" content="https://s3.amazonaws.com/twitter_production/profile_images/677605935/4332847590_e48074a0d7_o.jpg"><meta property="og:type" content="article"/><meta property="og:email" content="james@cridland.net"/><meta name="Title" content="James Cridland's little place on the web">
<meta name="Keywords" content="James Cridland Cridders">
<meta name="Description" content="A sample piece of PHP, or similar, for you to use however you like."><TITLE>Bits of PHP code - No Caching - James Cridland</TITLE><LINK rel="stylesheet" href="http://i1.muk.fm/jc/s.css?24Jan11"><meta http-equiv="Content-type" content="text/html;charset=UTF-8">
<link rel="meta" type="application/rdf+xml" title="FOAF" href="/foaf.rdf">
<meta name="microid" content="e855cd37f72d3a686f85718dc70e4a979dd3e753">
<link rel="openid.server" href="http://james.cridland.net/MyID.config.php">
<link rel="openid.delegate" href="http://james.cridland.net/MyID.config.php">
<script type="text/JavaScript" src="http://i2.muk.fm/jc/modernizr-1.1.min.js"></script>
<link rel="alternate" type="application/rss+xml" title="Blog" href="http://feeds.feedburner.com/JamesCridlandsBlog">
<link rel="alternate" type="application/rss+xml" title="Itemroll" href="http://feeds.feedburner.com/jamescridlanditemroll">
<link rel="pingback" href="http://james.cridland.net/blog/xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="Stalkerfeed" href="http://feeds.feedburner.com/jamescridland_stalkerfeed">
<script type="text/javascript">
Modernizr._fontfaceready(function(bool){
  if (!bool) {
  	replaceSelector("h2","/_inc/heading.php",false);
	replaceSelector("h3","/_inc/heading_small.php",false);
	replaceSelector("h4","/_inc/heading_small.php",false);
  }
});
</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-85965-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></HEAD><body><div id=topmenu><div class=rightmenu>

<!-- Google CSE Search Box Begins  -->
  <form id="searchbox_011504164764696342474:rjksgmermns" action="http://james.cridland.net/search/" style='margin:0;padding:0;'>
    <input type="hidden" name="cx" value="011504164764696342474:rjksgmermns">
    <input type="hidden" name="cof" value="FORID:10">
    <input name="q" type="text" size="21">
    <input type="submit" name="sa" value="Go">

<select size=1 name="select" onChange="if(options[selectedIndex].value) document.location.href=(options[selectedIndex].value)">
<option selected>Select a page</option>
<option value='/'>index</option>
<option value='/blog/'>blog</option>
<option value='/contacting_me/'>contacting me</option>
<option value='/biography/'>biography</option>
<option value='/ontheradio/'>on the radio</option>
<option value='/photos/'>photos</option>
<option value='/code/'>code</option>
<option value='/travels/'>travels</option>
<option value='/passwords/'>password generator</option>
<option value='/flickrcc/'>flickr cc search</option>
<option value='/fitaly/'>fitaly keyboard files</option>
<option value='/inventions/'>inventions</option>
</select>

  </form>
  <script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_011504164764696342474%3Arjksgmermns"></script>
<!-- Google CSE Search Box Ends -->
        
</div><script type="text/javascript">
window.google_analytics_uacct = "UA-85965-2";
</script><div class=text><a href='/'><img src='http://i1.muk.fm/jc/heading.png' alt='James Cridland' border=0></a></div></div><div style='position:absolute; top:35px; right:0px; width:242px;'>
<script type='text/javascript'><!--
google_ad_client = 'pub-5276900853299702';
/* 234x60 ATF james.cridland.net */
google_ad_slot = '2848266646';
google_ad_width = 234;
google_ad_height = 60;
//-->
</script>
<script type='text/javascript'
src='http://pagead2.googlesyndication.com/pagead/show_ads.js'>
</script></div>  <!--[if lt IE 7]>  <div style='border: 1px solid #F7941D; background: #FEEFDA; text-align: center; clear: both; height: 75px; position: relative;'>    <div style='position: absolute; right: 3px; top: 3px; font-family: courier new; font-weight: bold;'><a href='#' onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-cornerx.jpg' style='border: none;' alt='Close this notice'/></a></div>    <div style='width: 640px; margin: 0 auto; text-align: left; padding: 0; overflow: hidden; color: black;'>      <div style='width: 75px; float: left;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-warning.jpg' alt='Warning!'/></div>      <div style='width: 275px; float: left; font-family: Arial, sans-serif;'>        <div style='font-size: 14px; font-weight: bold; margin-top: 12px;'>You are using an outdated and insecure browser</div>        <div style='font-size: 12px; margin-top: 6px; line-height: 12px;'>For a better experience using this site, please upgrade to a modern web browser.</div>      </div>      <div style='width: 75px; float: left;'><a href='http://www.firefox.com' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-firefox.jpg' style='border: none;' alt='Get Firefox 3.5'/></a></div>      <div style='width: 75px; float: left;'><a href='http://www.browserforthebetter.com/download.html' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-ie8.jpg' style='border: none;' alt='Get Internet Explorer 8'/></a></div>      <div style='width: 73px; float: left;'><a href='http://www.apple.com/safari/download/' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-safari.jpg' style='border: none;' alt='Get Safari 4'/></a></div>      <div style='float: left;'><a href='http://www.google.com/chrome' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-chrome.jpg' style='border: none;' alt='Get Google Chrome'/></a></div>    </div>  </div>  <![endif]-->

<P class=subheader>No caching EVER</p>

<P>Defeating a browser's cache, or a proxy's cache, is more than using META tags. AOL ignores them, for a start, and anyway, you're better using proper headers. Thankfully, PHP lets you do that. So, if you NEVER want to cache a page, use this, right at the top of the page. I mean right at the top - no blank spaces, nothing.</P>

<P class=code>
&lt;?<BR>
//Set no caching<BR>
	header("Expires: Mon, 26 Jul 1997 05:00:00 GMT");<BR>
	header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT"); <BR>
	header("Cache-Control: no-store, no-cache, must-revalidate"); <BR>
	header("Cache-Control: post-check=0, pre-check=0", false);<BR>
	header("Pragma: no-cache");<BR>
?&gt;
</P>

<P>You probably don't want to ever use that, being honest: most of the time, you're better to only stop caching when you want your user to see a new version of a page they've just seen. So, if you only want to not-cache a page in certain circumstances, like returning to a forum index after you've allowed the user to add a new message, it's easier to fix this with your links...</p>

<P class=code>
&lt;?<BR>
//Link to a non-cacheable version of a page<BR>
echo "&lt;a href='index.html?nocache='.time().'&gt;Go back&lt;/a&gt;";<BR>
?&gt;
</P>

<P>This code will give you a link like caching.html?nocache=1310396425 - that number at the end changes once every second, so any proxy will have to reload it. Remember, though, that the page you put this link on may also cache.</p>

<p class=footer>These are my personal views and not those of any employer - <a href='/biography/disclosure.html'>Full disclosure</a> - <a href='/biography/privacy.html'>Privacy</a> - <a href='/faq/'>FAQ</a> - <a href='/contacting_me/'>Contact me</a> - Ads/hosting: <a href='http://notatallbad.ltd.uk/'>Not At All Bad Ltd</a><img src='http://s3.mediauk.com/_images/ukflag.gif' width=22 height=12 alt='Made in the UK' style='margin-left:6px;vertical-align:middle;'></p></BODY></HTML>